var DjangoTagMe=function(e){"use strict";function t(e){return{availableTags:new Set(e.choices||[]),selectedTags:new Set(e.selected||[]),tagOrder:e.selected||[],search:"",show:!1,menuShow:!1,isCreatingTag:!1,tagCreationError:null,focusedTag:null,screenWidth:window.innerWidth,addTagURL:e.addTagURL||"",permittedToAddTags:!1!==e.permittedToAddTags,allowMultiple:!1!==e.allowMultiple,autoSelectNewTags:!1!==e.autoSelectNewTags,maxDisplay:e.displayNumberSelected||2,helpUrl:e.helpUrl||"",mgmtUrl:e.mgmtUrl||"",init(){window.addEventListener("resize",()=>{this.screenWidth=window.innerWidth}),this._isReordering=!1,this.$nextTick(()=>{"undefined"!=typeof Sortable&&this.$refs.tagContainer&&new Sortable(this.$refs.tagContainer,{animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",draggable:".tm-tag-pill",setData:function(e,t){e.effectAllowed="move",e.setData("Text","")},onUpdate:e=>{this._isReordering||(this._isReordering=!0,e.preventDefault(),this.reorderTags(e.oldIndex,e.newIndex),this.$nextTick(()=>{this._isReordering=!1}))}})})},get isDesktop(){return this.screenWidth>=1024},get isMobile(){return this.screenWidth<1024},get filteredTags(){if(!this.search)return Array.from(this.availableTags).sort();const e=this.search.toLowerCase();return Array.from(this.availableTags).filter(t=>t.toLowerCase().includes(e)).sort((t,s)=>{const i=t.toLowerCase().startsWith(e),a=s.toLowerCase().startsWith(e);return i&&!a?-1:!i&&a?1:t.localeCompare(s)})},get selectedArray(){return this.tagOrder.filter(e=>this.selectedTags.has(e))},get displayedSelected(){return this.selectedArray.slice(0,this.maxDisplay)},get overflowCount(){return Math.max(0,this.selectedArray.length-this.maxDisplay)},get formValue(){return this.selectedArray.join(",")},get canAddTag(){const e=this.search.trim();return this.permittedToAddTags&&e.length>0&&0===this.filteredTags.length&&!this.availableTags.has(e)},get hasLinks(){return!(!this.helpUrl&&!this.mgmtUrl)},get menuBadge(){if(this.canAddTag)return{type:"add",show:!0,count:0,cssClass:"tm-badge-dot"};if(this.isMobile){let e=0;if(this.search.length>0&&e++,this.selectedTags.size>0&&e++,e>0)return{type:"actions",show:!0,count:e,cssClass:"tm-badge-count tm-badge-info"}}return{type:"none",show:!1,count:0,cssClass:""}},get menuButtonClass(){return this.canAddTag?"tm-menu-btn-primary":this.selectedTags.size>0?"tm-menu-btn-info":""},get showQuickActions(){return this.isDesktop&&(this.search.length>0||this.selectedTags.size>0)},get showInlineAdd(){return this.isDesktop&&this.canAddTag},toggleTag(e){if(this.selectedTags.has(e))this.selectedTags.delete(e),this.tagOrder=this.tagOrder.filter(t=>t!==e);else{if(!this.allowMultiple&&this.selectedTags.size>=1)return void alert("You've reached the maximum number of selections!");this.selectedTags.add(e),this.tagOrder.push(e)}},removeTag(e){this.selectedTags.delete(e),this.tagOrder=this.tagOrder.filter(t=>t!==e)},deselectAll(){this.selectedTags.clear(),this.tagOrder=[]},isSelected(e){return this.selectedTags.has(e)},reorderTags(e,t){const s=Math.min(this.tagOrder.length,this.maxDisplay);if(e<s&&t<s){const[s]=this.tagOrder.splice(e,1);this.tagOrder.splice(t,0,s)}},async createNewTag(){const e=this.search.trim();if(e&&this.permittedToAddTags){this.isCreatingTag=!0,this.tagCreationError=null;try{const t=await fetch(this.addTagURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams([["encoded_tag",this.base64Encode(e)],["csrfmiddlewaretoken",this.getCsrfToken()]])});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const s=await t.json();if(s.is_error)throw new Error(s.error_message||"Unknown server error");const i=s.tag||e;this.availableTags.has(i)||this.availableTags.add(i),this.autoSelectNewTags&&(this.selectedTags.add(i),this.tagOrder.push(i)),this.search="",this.tagCreationError=null,this.menuShow=!1}catch(t){this.tagCreationError=t.message||"Failed to create tag. Please try again."}finally{this.isCreatingTag=!1}}},clearSearch(){this.search="",this.tagCreationError=null,this.focusedTag=null},open(){this.show=!0,this.focusedTag=null},close(){this.show=!1,this.menuShow=!1,this.focusedTag=null},toggle(){this.show=!this.show,this.show||(this.menuShow=!1,this.focusedTag=null)},menuOpen(){this.menuShow=!0},menuClose(){this.menuShow=!1},menuToggle(){this.menuShow=!this.menuShow},navigateDown(){const e=this.filteredTags;if(0===e.length)return;const t=e.indexOf(this.focusedTag),s=t<0?0:Math.min(t+1,e.length-1);this.focusedTag=e[s]},navigateUp(){const e=this.filteredTags;if(0===e.length)return;const t=e.indexOf(this.focusedTag),s=t<0?0:Math.max(t-1,0);this.focusedTag=e[s]},selectFocused(){this.focusedTag&&this.filteredTags.includes(this.focusedTag)&&this.toggleTag(this.focusedTag)},isFocused(e){return this.focusedTag===e},resetFocus(){this.focusedTag=null},getCsrfToken(){const e=document.cookie.split(";");for(let t of e){const[e,s]=t.trim().split("=");if("csrftoken"===e)return decodeURIComponent(s)}return null},base64Encode:e=>btoa(JSON.stringify(e)),deselectTag(){this.deselectAll()},remove(e,t){t&&t.value&&this.removeTag(t.value)},selectedValues(){return this.selectedArray}}}if("undefined"!=typeof window){try{const e=t({choices:[],selected:[],addTagURL:"",permittedToAddTags:!0,allowMultiple:!0,autoSelectNewTags:!0,displayNumberSelected:2,helpUrl:"",mgmtUrl:""});try{e.menuBadge}catch(s){}}catch(s){}const e=()=>!(void 0===window.Alpine||!window.Alpine.data||(window.Alpine.data("alpineTagMeMultiSelect",t),0));e()||(document.addEventListener("alpine:init",()=>{e()}),setTimeout(()=>{window.Alpine},5e3))}return e.createAlpineComponent=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),"undefined"!=typeof window&&window.Alpine,e}({});
