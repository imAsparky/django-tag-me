var DjangoTagMe=function(e){"use strict";function t(e){return{availableTags:new Set(e.choices||[]),selectedTags:new Set(e.selected||[]),tagOrder:e.selected||[],search:"",show:!1,menuShow:!1,bottomSheetShow:!1,isCreatingTag:!1,tagCreationError:null,focusedTag:null,screenWidth:window.innerWidth,ariaAnnouncement:"",swipeState:{startX:null,startY:null,currentX:null,deltaX:0,isActive:!1,element:null,animationFrame:null},addTagURL:e.addTagURL||"",permittedToAddTags:!1!==e.permittedToAddTags,allowMultiple:!1!==e.allowMultiple,autoSelectNewTags:!1!==e.autoSelectNewTags,maxDisplay:e.displayNumberSelected||2,helpUrl:e.helpUrl||"",mgmtUrl:e.mgmtUrl||"",init(){window.addEventListener("resize",()=>{this.screenWidth=window.innerWidth})},get isDesktop(){return this.screenWidth>=768},get isMobile(){return this.screenWidth<768},get filteredTags(){if(!this.search)return Array.from(this.availableTags).sort();const e=this.search.toLowerCase();return Array.from(this.availableTags).filter(t=>t.toLowerCase().includes(e)).sort((t,s)=>{const i=t.toLowerCase().startsWith(e),a=s.toLowerCase().startsWith(e);return i&&!a?-1:!i&&a?1:t.localeCompare(s)})},get selectedArray(){return this.tagOrder.filter(e=>this.selectedTags.has(e))},get displayedSelected(){return this.selectedArray.slice(0,this.maxDisplay)},get overflowCount(){return Math.max(0,this.selectedArray.length-this.maxDisplay)},get formValue(){return this.selectedArray.join(",")},get canAddTag(){const e=this.search.trim();return this.permittedToAddTags&&e.length>0&&0===this.filteredTags.length&&!this.availableTags.has(e)},get hasLinks(){return!(!this.helpUrl&&!this.mgmtUrl)},get menuBadge(){if(this.canAddTag)return{type:"add",show:!0,count:0,cssClass:"tm-badge-dot"};if(this.isMobile){let e=0;if(this.search.length>0&&e++,this.selectedTags.size>0&&e++,e>0)return{type:"actions",show:!0,count:e,cssClass:"tm-badge-count tm-badge-info"}}return{type:"none",show:!1,count:0,cssClass:""}},get menuButtonClass(){return this.canAddTag?"tm-menu-btn-primary":this.selectedTags.size>0?"tm-menu-btn-info":""},get showQuickActions(){return this.isDesktop&&(this.search.length>0||this.selectedTags.size>0)},get showInlineAdd(){return this.isDesktop&&this.canAddTag},toggleTag(e){if(this.selectedTags.has(e))this.selectedTags.delete(e),this.tagOrder=this.tagOrder.filter(t=>t!==e),this.ariaAnnouncement=`Removed tag: ${e}`;else{if(!this.allowMultiple&&this.selectedTags.size>=1)return void alert("You've reached the maximum number of selections!");this.selectedTags.add(e),this.tagOrder.push(e),this.ariaAnnouncement=`Added tag: ${e}`}},removeTag(e){this.selectedTags.delete(e),this.tagOrder=this.tagOrder.filter(t=>t!==e),this.ariaAnnouncement=`Removed tag: ${e}`},deselectAll(){const e=this.selectedTags.size;this.selectedTags.clear(),this.tagOrder=[],this.ariaAnnouncement=`Removed all ${e} tags`},isSelected(e){return this.selectedTags.has(e)},async createNewTag(){const e=this.search.trim();if(e&&this.permittedToAddTags){this.isCreatingTag=!0,this.tagCreationError=null;try{const t=await fetch(this.addTagURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams([["encoded_tag",this.base64Encode(e)],["csrfmiddlewaretoken",this.getCsrfToken()]])});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const s=await t.json();if(s.is_error)throw new Error(s.error_message||"Unknown server error");const i=s.tag||e;this.availableTags.has(i)||this.availableTags.add(i),this.autoSelectNewTags?(this.selectedTags.add(i),this.tagOrder.push(i),this.ariaAnnouncement=`Created and selected tag: ${i}`):this.ariaAnnouncement=`Created tag: ${i}`,this.search="",this.tagCreationError=null,this.menuShow=!1,this.bottomSheetShow=!1}catch(t){this.tagCreationError=t.message||"Failed to create tag. Please try again."}finally{this.isCreatingTag=!1}}},clearSearch(){this.search="",this.tagCreationError=null,this.focusedTag=null},open(){this.show=!0,this.focusedTag=null},close(){this.show=!1,this.menuShow=!1,this.bottomSheetShow=!1,this.focusedTag=null},toggle(){this.show=!this.show,this.show||(this.menuShow=!1,this.bottomSheetShow=!1,this.focusedTag=null)},menuOpen(){this.menuShow=!0},menuClose(){this.menuShow=!1},menuToggle(){this.menuShow=!this.menuShow},openBottomSheet(){this.bottomSheetShow=!0,this.tagCreationError=null,this.menuShow=!1},closeBottomSheet(){this.bottomSheetShow=!1,this.tagCreationError=null},navigateDown(){const e=this.filteredTags;if(0===e.length)return;const t=e.indexOf(this.focusedTag),s=t<0?0:Math.min(t+1,e.length-1);this.focusedTag=e[s],this.ariaAnnouncement=`Focused: ${this.focusedTag}`},navigateUp(){const e=this.filteredTags;if(0===e.length)return;const t=e.indexOf(this.focusedTag),s=t<0?0:Math.max(t-1,0);this.focusedTag=e[s],this.ariaAnnouncement=`Focused: ${this.focusedTag}`},selectFocused(){this.focusedTag&&this.filteredTags.includes(this.focusedTag)&&this.toggleTag(this.focusedTag)},isFocused(e){return this.focusedTag===e},resetFocus(){this.focusedTag=null},handleSwipeStart(e,t){if(!this.isMobile)return;const s=e.touches[0];this.swipeState.startX=s.clientX,this.swipeState.startY=s.clientY,this.swipeState.currentX=s.clientX,this.swipeState.deltaX=0,this.swipeState.isActive=!1,this.swipeState.element=t,t.style.transition="none"},handleSwipeMove(e){if(!this.isMobile||!this.swipeState.startX||!this.swipeState.element)return;const t=e.touches[0];this.swipeState.currentX=t.clientX;const s=this.swipeState.currentX-this.swipeState.startX,i=t.clientY-this.swipeState.startY;!this.swipeState.isActive&&Math.abs(s)>Math.abs(i)&&Math.abs(s)>10&&(this.swipeState.isActive=!0,e.preventDefault()),this.swipeState.isActive&&(e.preventDefault(),this.swipeState.deltaX=s,this.swipeState.animationFrame&&cancelAnimationFrame(this.swipeState.animationFrame),this.swipeState.animationFrame=requestAnimationFrame(()=>{if(this.swipeState.element){const e=this.swipeState.element,t=.5*e.offsetWidth,s=Math.max(-t,Math.min(t,this.swipeState.deltaX));e.style.transform=`translateX(${s}px)`,Math.abs(s)>.3*t?e.classList.add("swipe-active"):e.classList.remove("swipe-active")}}))},handleSwipeEnd(e,t){if(!this.isMobile||!this.swipeState.element)return void this.resetSwipe();const s=this.swipeState.element,i=.5*s.offsetWidth,a=this.swipeState.deltaX;if(this.swipeState.isActive&&Math.abs(a)>=i){const e=a>0?1:-1,i=.7*s.offsetWidth*e;s.style.transition="transform 0.15s cubic-bezier(0.4, 0, 0.2, 1)",s.style.transform=`translateX(${i}px)`,setTimeout(()=>{this.toggleTag(t)},75),setTimeout(()=>{this.swipeState.element===s&&(s.style.transition="transform 0.2s ease-out",s.style.transform="",s.classList.remove("swipe-active"),setTimeout(()=>{this.resetSwipe()},200))},150)}else s.style.transition="transform 0.2s ease-out",s.style.transform="",s.classList.remove("swipe-active"),setTimeout(()=>{this.resetSwipe()},200)},resetSwipe(){this.swipeState.animationFrame&&cancelAnimationFrame(this.swipeState.animationFrame),this.swipeState.element&&(this.swipeState.element.style.transform="",this.swipeState.element.style.transition="",this.swipeState.element.classList.remove("swipe-active")),this.swipeState.startX=null,this.swipeState.startY=null,this.swipeState.currentX=null,this.swipeState.deltaX=0,this.swipeState.isActive=!1,this.swipeState.element=null,this.swipeState.animationFrame=null},getCsrfToken(){const e=document.cookie.split(";");for(let t of e){const[e,s]=t.trim().split("=");if("csrftoken"===e)return decodeURIComponent(s)}return null},base64Encode:e=>btoa(JSON.stringify(e)),deselectTag(){this.deselectAll()},remove(e,t){t&&t.value&&this.removeTag(t.value)},selectedValues(){return this.selectedArray}}}if("undefined"!=typeof window){try{const e=t({choices:[],selected:[],addTagURL:"",permittedToAddTags:!0,allowMultiple:!0,autoSelectNewTags:!0,displayNumberSelected:2,helpUrl:"",mgmtUrl:""});try{e.menuBadge}catch(s){}}catch(s){}const e=()=>!(void 0===window.Alpine||!window.Alpine.data||(window.Alpine.data("alpineTagMeMultiSelect",t),0));e()||(document.addEventListener("alpine:init",()=>{e()}),setTimeout(()=>{window.Alpine},5e3))}return e.createAlpineComponent=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),"undefined"!=typeof window&&window.Alpine,e}({});
