var DjangoTagMe=function(t){"use strict";function e(t){return{availableTags:new Set((t.choices||[]).filter(t=>t&&t.trim())),selectedTags:new Set((t.selected||[]).filter(t=>t&&t.trim())),tagOrder:(t.selected||[]).filter(t=>t&&t.trim()),search:"",show:!1,menuShow:!1,bottomSheetShow:!1,isCreatingTag:!1,tagCreationError:null,focusedTag:null,screenWidth:window.innerWidth,ariaAnnouncement:"",swipeState:{startX:null,startY:null,currentX:null,deltaX:0,isActive:!1,element:null,animationFrame:null},addTagURL:t.addTagURL||"",permittedToAddTags:!1!==t.permittedToAddTags,allowMultiple:!1!==t.allowMultiple,autoSelectNewTags:!1!==t.autoSelectNewTags,maxDisplay:t.displayNumberSelected||2,helpUrl:t.helpUrl||"",mgmtUrl:t.mgmtUrl||"",init(){window.addEventListener("resize",()=>{this.screenWidth=window.innerWidth})},get isDesktop(){return this.screenWidth>=768},get isMobile(){return this.screenWidth<768},get hasVirtualKeyboard(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},get shouldAutoFocus(){return!this.hasVirtualKeyboard},get filteredTags(){if(!this.search)return Array.from(this.availableTags).sort();const t=this.search.toLowerCase();return Array.from(this.availableTags).filter(e=>e.toLowerCase().includes(t)).sort((e,s)=>{const i=e.toLowerCase().startsWith(t),a=s.toLowerCase().startsWith(t);return i&&!a?-1:!i&&a?1:e.localeCompare(s)})},get selectedArray(){return this.tagOrder.filter(t=>this.selectedTags.has(t))},get displayedSelected(){return this.selectedArray.slice(0,this.maxDisplay)},get overflowCount(){return Math.max(0,this.selectedArray.length-this.maxDisplay)},get formValue(){return this.selectedArray.join(",")},get canAddTag(){const t=this.search.trim();return this.permittedToAddTags&&t.length>0&&0===this.filteredTags.length&&!this.availableTags.has(t)},get hasLinks(){return!(!this.helpUrl&&!this.mgmtUrl)},get menuBadge(){if(this.canAddTag)return{type:"add",show:!0,count:0,cssClass:"tm-badge-dot"};if(this.isMobile){let t=0;if(this.search.length>0&&t++,this.selectedTags.size>0&&t++,t>0)return{type:"actions",show:!0,count:t,cssClass:"tm-badge-count tm-badge-info"}}return{type:"none",show:!1,count:0,cssClass:""}},get menuButtonClass(){return this.canAddTag?"tm-menu-btn-primary":this.selectedTags.size>0?"tm-menu-btn-info":""},get showQuickActions(){return this.isDesktop&&(this.search.length>0||this.selectedTags.size>0)},get showInlineAdd(){return this.isDesktop&&this.canAddTag},toggleTag(t){if(this.selectedTags.has(t))this.selectedTags.delete(t),this.tagOrder=this.tagOrder.filter(e=>e!==t),this.ariaAnnouncement=`Removed tag: ${t}`;else{if(!this.allowMultiple&&this.selectedTags.size>=1)return void alert("You've reached the maximum number of selections!");this.selectedTags.add(t),this.tagOrder.push(t),this.ariaAnnouncement=`Added tag: ${t}`}},removeTag(t){this.selectedTags.delete(t),this.tagOrder=this.tagOrder.filter(e=>e!==t),this.ariaAnnouncement=`Removed tag: ${t}`},deselectAll(){const t=this.selectedTags.size;this.selectedTags.clear(),this.tagOrder=[],this.ariaAnnouncement=`Removed all ${t} tags`},isSelected(t){return this.selectedTags.has(t)},async createNewTag(){const t=this.search.trim();if(t&&this.permittedToAddTags){this.isCreatingTag=!0,this.tagCreationError=null;try{const e=await fetch(this.addTagURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams([["encoded_tag",this.base64Encode(t)],["csrfmiddlewaretoken",this.getCsrfToken()]])});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const s=await e.json();if(s.is_error)throw new Error(s.error_message||"Unknown server error");const i=s.tag||t;this.availableTags.has(i)||this.availableTags.add(i),this.autoSelectNewTags?(this.selectedTags.add(i),this.tagOrder.push(i),this.ariaAnnouncement=`Created and selected tag: ${i}`):this.ariaAnnouncement=`Created tag: ${i}`,this.search="",this.tagCreationError=null,this.menuShow=!1,this.bottomSheetShow=!1}catch(e){this.tagCreationError=e.message||"Failed to create tag. Please try again."}finally{this.isCreatingTag=!1}}},clearSearch(){this.search="",this.tagCreationError=null,this.focusedTag=null},open(){this.show=!0,this.focusedTag=null},close(){this.show=!1,this.menuShow=!1,this.bottomSheetShow=!1,this.focusedTag=null},toggle(){this.show=!this.show,this.show||(this.menuShow=!1,this.bottomSheetShow=!1,this.focusedTag=null)},menuOpen(){this.menuShow=!0},menuClose(){this.menuShow=!1},menuToggle(){this.menuShow=!this.menuShow},openBottomSheet(){this.bottomSheetShow=!0,this.tagCreationError=null,this.menuShow=!1},closeBottomSheet(){this.bottomSheetShow=!1,this.tagCreationError=null},navigateDown(){const t=this.filteredTags;if(0===t.length)return;const e=t.indexOf(this.focusedTag),s=e<0?0:Math.min(e+1,t.length-1);this.focusedTag=t[s],this.$nextTick(()=>{const t=document.getElementById(`tag-option-${this.focusedTag}`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}),this.ariaAnnouncement=`Focused: ${this.focusedTag}`},navigateUp(){const t=this.filteredTags;if(0===t.length)return;const e=t.indexOf(this.focusedTag),s=e<0?0:Math.max(e-1,0);this.focusedTag=t[s],this.$nextTick(()=>{const t=document.getElementById(`tag-option-${this.focusedTag}`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}),this.ariaAnnouncement=`Focused: ${this.focusedTag}`},selectFocused(){!this.focusedTag&&this.filteredTags.length>0&&(this.focusedTag=this.filteredTags[0]),this.focusedTag&&this.filteredTags.includes(this.focusedTag)&&this.toggleTag(this.focusedTag)},isFocused(t){return this.focusedTag===t},resetFocus(){this.focusedTag=null},handleSwipeStart(t,e){if(!this.isMobile)return;const s=t.touches[0];this.swipeState.startX=s.clientX,this.swipeState.startY=s.clientY,this.swipeState.currentX=s.clientX,this.swipeState.deltaX=0,this.swipeState.isActive=!1,this.swipeState.element=e,e.style.transition="none"},handleSwipeMove(t){if(!this.isMobile||!this.swipeState.startX||!this.swipeState.element)return;const e=t.touches[0];this.swipeState.currentX=e.clientX;const s=this.swipeState.currentX-this.swipeState.startX,i=e.clientY-this.swipeState.startY;!this.swipeState.isActive&&Math.abs(s)>Math.abs(i)&&Math.abs(s)>10&&(this.swipeState.isActive=!0,t.preventDefault()),this.swipeState.isActive&&(t.preventDefault(),this.swipeState.deltaX=s,this.swipeState.animationFrame&&cancelAnimationFrame(this.swipeState.animationFrame),this.swipeState.animationFrame=requestAnimationFrame(()=>{if(this.swipeState.element){const t=this.swipeState.element,e=.5*t.offsetWidth,s=Math.max(-e,Math.min(e,this.swipeState.deltaX));t.style.transform=`translateX(${s}px)`,Math.abs(s)>.3*e?t.classList.add("swipe-active"):t.classList.remove("swipe-active")}}))},handleSwipeEnd(t,e){if(!this.isMobile||!this.swipeState.element)return void this.resetSwipe();const s=this.swipeState.element,i=.5*s.offsetWidth,a=this.swipeState.deltaX;if(this.swipeState.isActive&&Math.abs(a)>=i){const t=a>0?1:-1,i=.7*s.offsetWidth*t;s.style.transition="transform 0.15s cubic-bezier(0.4, 0, 0.2, 1)",s.style.transform=`translateX(${i}px)`,setTimeout(()=>{this.toggleTag(e)},75),setTimeout(()=>{this.swipeState.element===s&&(s.style.transition="transform 0.2s ease-out",s.style.transform="",s.classList.remove("swipe-active"),setTimeout(()=>{this.resetSwipe()},200))},150)}else s.style.transition="transform 0.2s ease-out",s.style.transform="",s.classList.remove("swipe-active"),setTimeout(()=>{this.resetSwipe()},200)},resetSwipe(){this.swipeState.animationFrame&&cancelAnimationFrame(this.swipeState.animationFrame),this.swipeState.element&&(this.swipeState.element.style.transform="",this.swipeState.element.style.transition="",this.swipeState.element.classList.remove("swipe-active")),this.swipeState.startX=null,this.swipeState.startY=null,this.swipeState.currentX=null,this.swipeState.deltaX=0,this.swipeState.isActive=!1,this.swipeState.element=null,this.swipeState.animationFrame=null},getCsrfToken(){const t=document.cookie.split(";");for(let e of t){const[t,s]=e.trim().split("=");if("csrftoken"===t)return decodeURIComponent(s)}return null},base64Encode:t=>btoa(JSON.stringify(t))}}if("undefined"!=typeof window){try{const t=e({choices:[],selected:[],addTagURL:"",permittedToAddTags:!0,allowMultiple:!0,autoSelectNewTags:!0,displayNumberSelected:2,helpUrl:"",mgmtUrl:""});try{t.menuBadge}catch(s){}}catch(s){}const t=()=>!(void 0===window.Alpine||!window.Alpine.data||(window.Alpine.data("alpineTagMeMultiSelect",e),0));t()||(document.addEventListener("alpine:init",()=>{t()}),setTimeout(()=>{window.Alpine},5e3))}return t.createAlpineComponent=e,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),"undefined"!=typeof window&&window.Alpine,t}({});
