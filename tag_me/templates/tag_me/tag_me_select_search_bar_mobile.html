{# tag_me/templates/tag_me/tag_me_select_search_bar_mobile.html #}
{% comment %}
  MOBILE SEARCH BAR ACTIONS - CONTEXT AWARE
  Shows ONE big, clear action button based on current state
  Priority: Creating > Can Add > Has Search > Has Selected Tags
{% endcomment %}

<!-- Context-Aware Action Button (Mobile) -->
<div class="relative">

  <!-- PRIORITY 1: Loading/Creating Tag -->
  <div x-show="isCreatingTag" 
       class="inline-flex items-center px-2"
       x-transition:enter="transition ease-out duration-150"
       x-transition:enter-start="opacity-0 scale-90"
       x-transition:enter-end="opacity-100 scale-100"
       x-transition:leave="transition ease-in duration-150"
       x-transition:leave-start="opacity-100 scale-100"
       x-transition:leave-end="opacity-0 scale-90">
    <svg class="animate-spin h-6 w-6 text-indigo-500 dark:text-indigo-400"
         xmlns="http://www.w3.org/2000/svg"
         fill="none"
         viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </div>

  <!-- PRIORITY 2: Add Tag Button (when can add new tag) -->
  <button type="button"
          x-show="canAddTag && !isCreatingTag"
          x-transition:enter="transition ease-out duration-150"
          x-transition:enter-start="opacity-0 scale-90"
          x-transition:enter-end="opacity-100 scale-100"
          x-transition:leave="transition ease-in duration-150"
          x-transition:leave-start="opacity-100 scale-100"
          x-transition:leave-end="opacity-0 scale-90"
          @click.stop="openBottomSheet()"
          class="inline-flex items-center justify-center w-[44px] h-[44px] text-white bg-indigo-600 rounded-lg transition-all duration-150 hover:bg-indigo-500 active:scale-95 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-gray-800"
          aria-label="Add new tag">
    <svg xmlns="http://www.w3.org/2000/svg"
         class="h-5 w-5"
         fill="none"
         viewBox="0 0 24 24"
         stroke="currentColor"
         stroke-width="2.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
    </svg>
  </button>

  <!-- PRIORITY 3: Clear Search Button (when search has text) -->
  <button type="button"
          x-show="search.length > 0 && !canAddTag && !isCreatingTag"
          x-transition:enter="transition ease-out duration-150"
          x-transition:enter-start="opacity-0 scale-90"
          x-transition:enter-end="opacity-100 scale-100"
          x-transition:leave="transition ease-in duration-150"
          x-transition:leave-start="opacity-100 scale-100"
          x-transition:leave-end="opacity-0 scale-90"
          @click.stop="clearSearch()"
          class="inline-flex items-center justify-center w-[44px] h-[44px] text-gray-600 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded-lg transition-all duration-150 hover:bg-gray-300 dark:hover:bg-gray-600 hover:text-gray-900 dark:hover:text-white active:scale-95 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-gray-800"
          aria-label="Clear search">
    <svg xmlns="http://www.w3.org/2000/svg"
         class="h-5 w-5"
         fill="none"
         viewBox="0 0 24 24"
         stroke="currentColor"
         stroke-width="2.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="m6 6 12 12m3-6a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
    </svg>
  </button>

  <!-- PRIORITY 4: Remove All Tags Button (when tags selected and no search) -->
  <button type="button"
          x-show="selectedTags.size > 0 && search.length === 0 && !canAddTag && !isCreatingTag"
          x-transition:enter="transition ease-out duration-150"
          x-transition:enter-start="opacity-0 scale-90"
          x-transition:enter-end="opacity-100 scale-100"
          x-transition:leave="transition ease-in duration-150"
          x-transition:leave-start="opacity-100 scale-100"
          x-transition:leave-end="opacity-0 scale-90"
          @click.stop="deselectAll()"
          class="relative inline-flex items-center justify-center w-[44px] h-[44px] p-2 text-gray-600 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded-lg transition-all duration-150 hover:bg-gray-300 dark:hover:bg-gray-600 hover:text-gray-900 dark:hover:text-white active:scale-95 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-gray-800"
          :aria-label="'Remove ' + selectedTags.size + ' tags'">
    <svg xmlns="http://www.w3.org/2000/svg"
         class="h-5 w-5"
         fill="none"
         viewBox="0 0 24 24"
         stroke="currentColor"
         stroke-width="2.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1ZM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7Z" />
    </svg>
    <!-- Badge showing count -->
    <span class="absolute -top-0.5 -right-0.5 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] font-bold leading-none text-white bg-indigo-600 rounded-full min-w-[1rem]"
          x-text="selectedTags.size"></span>
  </button>

</div>
